---
- name: Install mysql, nginx and httpd software
  hosts: all
  remote_user: root
  vars:
    packages:
        - name: nginx
          required: True
#        - name: mysql
#          required: True
        - name: httpd
          required: True

  tasks:
    - name: Install '{{ item.name }}' in RHEL
      yum:
        name: '{{ item.name }}'
        state: present
      when: item.required == True
      loop: "{{ packages }}"
    - name: Ensure service running
      service:
        name: '{{ item.name }}'
        state: started
      when: item.required == True
      loop: "{{ packages }}"
    - name: Nginx template files to parse
      template:
        src: default.conf
        dest: /etc/nginx/conf.d/default.conf
      vars:
        #file: variable.yml
        nginx_port: 8090 #'{{ nginx_port }}'
    - name:
      copy:
        src: README.md
        dest: /etc/nginx
        #: {{ nginx_port }}
      #  nginx_port: 8889
    - name: Restart
      service:
        name: nginx
        state: reloaded
    - name: Enable nginx service on reboot
      service:
        name: nginx
        enabled: yes
    - name: Enable Apache service on reboot
      service:
        name: httpd
        enabled: yes
#    - include_vars:
#    - name: Change port and restart
#      service:
#        name: nginx
#        state: restarted
